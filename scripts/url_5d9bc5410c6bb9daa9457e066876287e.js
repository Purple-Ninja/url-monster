var flags={isCmp:false},urlObj={u1:null,u2:null},mLastFragment="";function generateURLComponentValueFieldHTML(c,d,b){var a='<input type="text" class="editable url ';if(b==2){a+="u2"}else{a+="u1"}a+='" value="';a+=(d==null)?(""):(d.replace(/\"/g,"&quot;"));a+='" lid="'+c+'" lurl="'+b+'" ';if(d==null){a+='placeholder="UNDEFINED"'}a+="/>";return a}function generateURLComponentTitleHTML(b){var a="",c;if(c=b.match(/^([a-z]+)-(.*)/)){a+='<span class="name">'+c[2]+"</span>";a+='<span class="meta">'+c[1]+"</span>"}else{a+='<span class="name">'+b+"</span>"}return a}function generateURLComponentHTML(c,d,b){var a="";a+='<div id="url-'+c+'" class="compt ';if(flags.isCmp){a+="diff"}a+='">';a+='<span class="fd">';a+=generateURLComponentTitleHTML(c);a+="</span>";if(flags.isCmp){if(b==1){a+=generateURLComponentValueFieldHTML(c,d,1);a+=generateURLComponentValueFieldHTML(c,null,2)}else{a+=generateURLComponentValueFieldHTML(c,null,1);a+=generateURLComponentValueFieldHTML(c,d,2)}}else{a+=generateURLComponentValueFieldHTML(c,d,b)}a+="</div>";return a}function addOrUpdateDom(e,d,b){var a=$("#parsed"),c=$("#url-"+e);if(!b){b=1}if(d==null&&e=="port"){d="80"}if(c.length>0){$("#url-"+e+" .u"+b).val(d);if($("#url-"+e+" .u1").val()!=$("#url-"+e+" .u2").val()){c.addClass("diff")}else{c.removeClass("diff")}}else{a.append(generateURLComponentHTML(e,d,b))}}function display(d,b){var a=$("#parsed"),c,f,h=[d,b];a.html("");for(f=0;f<h.length;f++){for(var e in h[f]){if(e=="query"||(e=="fragment"&&h[f][e]!=null&&h[f][e].match(/=/))){c=URI.parseQuery(h[f][e]);for(var g in c){addOrUpdateDom(e+"-"+g,c[g],f+1)}}if(e!="query"){addOrUpdateDom(e,h[f][e],f+1)}}}}function parse(d,c){var b=URI.parse(d),a=false;if(c!==""){a=URI.parse(c);$("#msgs .msg.cmp").removeClass("hidden");flags.isCmp=true}else{$("#msgs .msg.cmp").addClass("hidden");flags.isCmp=false}urlObj.u1=b;urlObj.u2=a;display(b,a);if(flags.isCmp){if($("#parsed .compt.diff").length>0){$("#msgs .msg.cmp .same").addClass("hidden");$("#msgs .msg.cmp .diff").removeClass("hidden");showOnly(0)}else{$("#msgs .msg.cmp .same").removeClass("hidden");$("#msgs .msg.cmp .diff").addClass("hidden");showOnly(2)}}else{showOnly(2)}saveMonsterUrl(d,c)}function saveMonsterUrl(c,b){var a=URI.buildQuery({u1:c,u2:b});location.href="#"+a}function showOnly(a){$("#msgs .msg.cmp .act .cab").removeClass("ckd");if(a>0){$("#parsed .compt").removeClass("hidden");if(a==1){$("#parsed .compt.diff").addClass("hidden");$("#show-s").addClass("ckd")}else{$("#show-a").addClass("ckd")}}else{$("#parsed .compt").addClass("hidden");$("#parsed .compt.diff").removeClass("hidden");$("#show-d").addClass("ckd")}}function getCompositeFieldValue(b,a,c,e){var d;if(urlObj["u"+b][a]){d=URI.parseQuery(urlObj["u"+b][a])}else{d=[]}d[c]=e;return URI.buildQuery(d)}function editUrl(b,a,g){var e,d;if(e=a.match(/^([a-z]+)-(.*)/)){g=getCompositeFieldValue(b,e[1],e[2],g);d=e[1]}else{d=a}if(urlObj["u"+b][d]==g){return false}var f=$("#u1"),c=$("#u2"),g;urlObj["u"+b][d]=g;$("#u"+b).val(URI.build(urlObj["u"+b]));parse(f.val(),c.val());g=$("#url-"+a+" .u"+b).val();$("#url-"+a+" .u"+b).focus().val("").val(g)}$(function(){var e=$("#u1"),d=$("#u2"),c="change keyup input paste",b,a;e.bind(c,function(){parse(e.val(),d.val())});d.bind(c,function(){parse(e.val(),d.val())});$("#parsed").on(c,".editable",function(j){var i=$(j.target),g=i.attr("lid"),f=i.attr("lurl"),h=i.val();editUrl(f,g,h)});$("#show-a").on("click",function(){showOnly(2)});$("#show-d").on("click",function(){showOnly(0)});$("#show-s").on("click",function(){showOnly(1)});$(".actions .act-go-cr").on("click",function(h){var g=$(h.target).parent().attr("data-uid"),f;if(g==1){f=e.val()}else{f=d.val()}if(f!=""){location.href=f}});$(".actions .act-go-new").on("click",function(h){var g=$(h.target).parent().attr("data-uid"),f;if(g==1){f=e.val()}else{f=d.val()}if(f!=""){window.open(f)}});$(".actions .act-clear").on("click",function(h){var g=$(h.target).parent().attr("data-uid"),f;if(g==1){e.val("");e.focus()}else{d.val("");d.focus()}parse(e.val(),d.val())});b=URI.parse(location.href);if(b.fragment){a=URI.parseQuery(b.fragment);if(a.u1){e.val(a.u1)}if(a.u2){d.val(a.u2)}mLastFragment=b.fragment}if(e.val()==""){e.focus()}else{parse(e.val(),d.val())}});